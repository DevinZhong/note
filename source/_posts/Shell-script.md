---
title: Shell script
date: 2017-01-31 23:36:16
tags:
  - Linux
  - Shell script
categories: Linux
---

> Shell脚本（英语：Shell script），又稱Shell命令稿、程式化腳本，是一種電腦程式與文字檔案，內容由一連串的shell命令組成，經由Unix Shell直譯其內容後運作。
<!-- more -->


## 环境变量与用户自定义变量的区别
- 用户自定义变量只在当前的 Shell 中生效
- 环境变量在当前 Shell 和这个 Shell 的所有子 Shell 中生效


## Bash Shell 预定义变量
预定义变量 | 存放内容
-----------|-------------------------------------------------
$HOSTTYPE | 机器CPU类型（i386,i686,x86_64）
$LANG | 机器语言及编码（en_US.UTF-8）
$BASH | 当前Bash类型（/bin/bash,/bin/sh）
$BASH_VERSION | bash版本（3.2.25(1)-release）
$MACHTYPE | 机器类型machine type（x86_64-redhat-linux-gnu）
$HOSTNAME | 主机名
$OSTYPE | 操作系统类型（linux-gnu）
$PATH | 环境变量
$LOGNAME | 当前登录用户名
$TERM | term类型（xterm）
$RANDOM | 产生随机整数
$SHELL | 当前的shell
$HISTSIZE | 历史命令条数
$SSH_CLIENT | 当前操作环境是用ssh连接的，这里记录客户端IP
$SSH_TTY | ssh连接的终端是pts/1
$USER | 当前登录的用户
$PS1 | 命令提示符设置

## Shell中常见字串含义
字串 | 含义
---------------|-------------------------------------------------
$$ | 当前进程的pid
$! | 获取上条命令执行的进程pid
$? | 获取程序返回值（成功为0，错误为其他）
$# | 获取参数个数
$@ | 获取参数列表 （$* 也是获取参数列表）
{% raw %}${#array[@]}{% endraw %} | 获取数组长度（元素个数）
${array[*]} | 获取数组元素列表


## Bang (!) 命令
命令 | 含义
----------|----------------------------------------------
!! | 执行上一条命令，常用于 `sudo !!` 以管理员权限执行上一条命令
!# | 目前已经输入的整个命令
!blah | 执行最近的以 blah 开头的命令，如 !ls
!blah:p | 仅打印输出，而不执行
!$ | 上一条命令的最后一个参数，与 Alt + . 相同
!$:p | 打印输出 !$ 的内容
!^ | 上条命令的第一个参数
!* | 上一条命令的所有参数
!*:p | 打印输出 !* 的内容
^blah | 删除上一条命令中的 blah
^blah^foo | 将上一条命令中的 blah 替换为 foo
!-n | 选择倒数第 n 条命令
!!:^ | 获取上条命令的第一个参数，同 !^ 和 !!:1
!!:$ | 获取上条命令 的最后一个参数，同 !$ 和 $_
!!:n | 获取上条命令的第 n 个参数
!string:n | 获取最近执行过的 string 开头的命令的第 n 个参数

## Here Documents
```bash
var="Linux"

# EOF 只是一个标识而已，可以替换成任意的合法字符
# 作为起始的 delimiter 前后的空格会被省略掉
cat << EOF
Hello $var
        Hello ${var}
EOF

# 使用引号，不展开变量
cat << "EOF"
Hello $var
        Hello ${var}
EOF

# 使用 <<-，将每行前面的 tab（制表符）去除
cat <<- EOF
Hello $var
        Hello ${var}
EOF
```


## read
> 格式：read [选项] [变量名]
### 常用选项
| 选项范例 | 解释 |
|------|------------------------------|
| -p "提示信息" | 输出提示信息 |
| -t 秒数 | 指定等待时间 |
| -n 字符数 | 只接受指定的字符数就会执行 |
| -s | 隐藏输入的数据，适用于机密信息的输入 |

## declare
> 格式：declare [+/-][选项] 变量名
### 常用选项
| 选项 | 功能 |
|-----|--------------------------|
| - | 给变量设定类型属性 |
| + | 取消变量的类型属性 |
| -a | 将变量声明为数组型 |
| -i | 将变量声明为整数型（integer） |
| -x | 将变量声明为环境变量 |
| -r | 将变量声明为只读变量 |
| -p | 显示指定变量被声明的类型 |

## 杂项
- 反引号和`$()`作用一样，推荐使用`$()`，因为反引号容易看错